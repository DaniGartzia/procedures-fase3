CREATE OR REPLACE PACKAGE gest_centro IS
TYPE centros_cursor IS REF CURSOR;

PROCEDURE insertar_centro (
  p_id IN CENTROTRABAJO.ID%TYPE,
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE,
  p_calle IN CENTROTRABAJO.CALLE%TYPE,
  p_numero IN CENTROTRABAJO.NUMERO%TYPE,
  p_cod_postal IN CENTROTRABAJO.COD_POSTAL%TYPE,
  p_ciudad IN CENTROTRABAJO.CIUDAD%TYPE,
  p_provincia IN CENTROTRABAJO.PROVINCIA%TYPE,
  p_telefono IN CENTROTRABAJO.TELEFONO%TYPE);
  
PROCEDURE borrar_centro (
  p_id IN CENTROTRABAJO.ID%TYPE);
  
PROCEDURE cambiar_provincia (
  p_id IN CENTROTRABAJO.ID%TYPE,
  p_provincia IN CENTROTRABAJO.PROVINCIA%TYPE);
  
PROCEDURE visualizar_lista_centros (
  p_todos_centros OUT centros_cursor);
  
PROCEDURE visualizar_datos_centros_id (
  p_id IN CENTROTRABAJO.ID%TYPE);
  
PROCEDURE buscar_centro_por_nombre (
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE,
  p_id OUT CENTROTRABAJO.ID%TYPE);
  
PROCEDURE visualizar_datos_centros_nombre (
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE);
  
END;

CREATE OR REPLACE PACKAGE BODY gest_centro IS
PROCEDURE insertar_centro (
  p_id IN CENTROTRABAJO.ID%TYPE,
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE,
  p_calle IN CENTROTRABAJO.CALLE%TYPE,
  p_numero IN CENTROTRABAJO.NUMERO%TYPE,
  p_cod_postal IN CENTROTRABAJO.COD_POSTAL%TYPE,
  p_ciudad IN CENTROTRABAJO.CIUDAD%TYPE,
  p_provincia IN CENTROTRABAJO.PROVINCIA%TYPE,
  p_telefono IN CENTROTRABAJO.TELEFONO%TYPE) IS
  BEGIN
    INSERT INTO CENTROTRABAJO
    VALUES(p_id, p_nombre, p_calle, p_numero, p_cod_postal, p_ciudad, p_provincia, p_telefono);
  END insertar_centro;
  
PROCEDURE borrar_centro (
  p_id IN CENTROTRABAJO.ID%TYPE) IS
  BEGIN
    DELETE FORM CENTROTRABAJO
    WHERE id = p_id;
  END borrar_centro;
  
PROCEDURE cambiar_provincia (
  p_id IN CENTROTRABAJO.ID%TYPE,
  p_provincia IN CENTROTRABAJO.PROVINCIA%TYPE) IS
  BEGIN 
    UPDATE CENTROTRABAJO
    SET PROVINCIA = LOWER(p_provincia)
    WHERE id = p_id;
  END cambiar_provincia;
  
PROCEDURE visualizar_lista_centros (
  p_todos_centros OUT centros_cursor) IS
  BEGIN
    OPEN p_todos_centros FOR
    (SELECT * FROM CENTROTRABAJO);
  END visualizar_lista_centros;
  
PROCEDURE visualizar_datos_centros (
  p_id IN CENTROTRABAJO.ID%TYPE) IS
  BEGIN 
    SELECT * FROM CENTROTRABAJO
    WHERE id = p_id;
  END visualizar_datos_centros_id;

FUNCTION buscar_centro_por_nombre (
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE) RETURN NUMBER IS p_id CENTROTRABAJO.ID%TYPE;
  BEGIN
    SELECT ID INTO p_id
    FROM CENTROTRABAJO
    WHERE NOMBRE = LOWER(p_nombre);
  END buscar_centro_por_nombre;
  
PROCEDURE visualizar_datos_centros (
  p_nombre IN CENTROTRABAJO.NOMBRE%TYPE) IS
  EXEC buscar_centro_por_nombre (p_nombre) RETURN NUMBER AS p_id;
  BEGIN
  
    SELECT C.ID, C.NOMBRE CNOM, C.CALLE, C.NUMERO, C.COD_POSTAL, C.CIUDAD, C.PROVINCIA, C.TELEFONO, COUNT(T.DNI) AS "NUMERO TRABAJADORES"
  
  
  
    
  
  

  